{% extends 'party/base.html' %}
{% block content %}

<title>RSVP</title>

<h2>RSVP Form</h2>
<form method="post">
    {% csrf_token %}
    <div>{{ form.name.label_tag }} {{ form.name }}</div>
    <div>{{ form.attend.label_tag }} {{ form.attend }}</div>
    <div>{{ form.group_type.label_tag }} {{ form.group_type }}</div>
    <div>{{ form.number_of_guests.label_tag }} {{ form.number_of_guests }}</div>
    <div>{{ form.guest_names.label_tag }} {{ form.guest_names }}</div>
    <div>{{ form.invite.label_tag }} {{ form.invite }}</div>

    <button type="submit">Submit</button>
</form>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const choiceType = document.getElementById("id_attend");
        const groupType = document.getElementById("id_group_type");
        const numberGuests = document.getElementById("id_number_of_guests");
        const guestNames = document.getElementById("id_guest_names");

        const groupTypeDiv = groupType?.parentElement;
        const guestsFieldDiv = numberGuests?.parentElement;
        const guestNamesFieldDiv = guestNames?.parentElement;

        function updateFormFields() {
            const attending = choiceType.checked;

            if (!attending) {
                if (groupTypeDiv) groupTypeDiv.style.display = "none";
                if (guestsFieldDiv) guestsFieldDiv.style.display = "none";
                if (guestNamesFieldDiv) guestNamesFieldDiv.style.display = "none";
                return;
            }

            // If attending, show all fields
            if (groupTypeDiv) groupTypeDiv.style.display = "block";
            if (guestsFieldDiv) guestsFieldDiv.style.display = "block";
            if (guestNamesFieldDiv) guestNamesFieldDiv.style.display = "block";

            // Optional: Handle group_type auto-zero logic here if needed
            if (groupType.value === "self" || groupType.value === "other") {
                numberGuests.value = 0;
                if (guestsFieldDiv) guestsFieldDiv.style.display = "none";
                if (guestNamesFieldDiv) guestNamesFieldDiv.style.display = "none";
            }
        }

        // Run on change and on load
        choiceType.addEventListener("change", updateFormFields);
        groupType.addEventListener("change", updateFormFields);
        updateFormFields();
    });
</script>

{% endblock %}